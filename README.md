# ISAE: Identify super accessibility elements  

## 1.Introduction  
The software was used to identify super accessibility elements (SAEs) using ATAC-seq data, which were open chromatin regions in promoters or enhancers that are strongly bound simultaneously by multiple lineage-specific TFs. In addition to this, the software can also associate SAEs with gene expression and identify differential SAEs between different tissues/cell stages and types considering the change both in ATAC signal and TF footprint binding.   

## 2.Dependencies  
python3  
R > v3.4  
perl > v5  
bedtools > v2  
samtools > v1  
macs2 > v2  
pyDNase v0.030  
HOMER > v4  
wigToBigWig  
bigWigToBedGraph  

Most of these dependencies can be installed at once using conda: http://conda.pydata.org/miniconda.html  
## 3.Installation  
```
git clone https://github.com/MingyangHu/ISAE.git
export PATH=$PATH:/path/to/SAE/bin
```

## 4.Usage  
### 1>Idnetify_SAE.py  
The script was used to call ATAC broad peak, identify footprints in ATAC peak and super accessibility elements.    
```
Idnetify_SAE.py [options] -t Input_align_file_for_call_peak -b Bam_file -n Experiment_name  -o Output_directory  -g Effective_genome_size --g_file the_chrom_size_file  
```
* Explanation of parameters    
-n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Experiment name, which will be used to generate output file names.    
-p&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Number of processes to use.    
--outdir &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Path to output directory.    
--Broad_peak &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If --macs2_call_peak choose "off", please provide a broad peak bed file.    
--footprint_file &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If choose "off" for --wellington_footprints, please provide the footprint bed file with score information.  
###############Macs2 call peak  
-t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The algin file of ATAC-seq data. It is strongly recommended to use the tn5.tagAlign file generated by the ENCODE ATAC-seq pipeline (https://github.com/kundajelab/atac_dnase_pipelines), in which all reads aligning to the + strand were offset by +4 bp, and all reads aligning to the – strand were offset −5 bp.  
-f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Format of algin file,{AUTO,BAM,SAM,BED,ELAND,ELANDMULTI,ELANDEXPORT,BOWTIE,BAMPE,BEDPE}. The default AUTO option will let MACS decide which format. Default: AUTO     
-g &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Effective genome size.It can be 1.0e+9 or 1000000000, or shortcuts:'hs' for human (2.7e9), 'mm' for mouse(1.87e9), 'ce' for C. elegans (9e7) and 'dm' for fruitfly (1.2e8). Default: hs.    
--pvalue &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Pvalue threshold to filter peak, Default: 5 (means *P* value < 1E-5).    
--macs2_call_peak &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Whether using macs2 to call peak,can choose "on" or "off". Default: on    
###############Footprint analysis  
-b&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Bam file of ATAC-seq data.   
-A&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ATAC-seq mode (default: True).      
--wellington_footprints&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Whether to execute footprint analysis,can choose "on" or "off".Default:on  
###############Identify SAE  
--proximal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp;  &nbsp; Whether to identify proximal(TSS)-SAE, can choose "on" or "off". Default: on  
--distal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp;  &nbsp; Whether to identify distal-SAE,can choose "on" or "off". Default: on  
--c_proximal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &ensp; The threshold of footrint score and footprint number to identify proximal-(TSS) SAE. {10,15,20}. Default: 10.   
--c_distal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &ensp; The threshold of footrint score and footprint number to identify distal- SAE. {10,15,20}. Default: 10.   
--TSS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &ensp; Bed file of gene promoter or TSS site.  
--houseKeeping&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Bed file of houseKeeping gene promoter or TSS site.  
-h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print this help menu.  
* Usage examples  
I.The following is an example using align file as the input, the analysis process includes peak calling, footprint analysis and SAE identification.  
 ```  
Idnetify_SAE.py -t C2C12-DM60h-ATAC.nodup.tn5.tagAlign.gz -g mm -n C2C12_DM60h_ATAC -A -p 8 -b C2C12-DM60h-ATAC.nodup.bam --outdir /path/to/C2C12_DM60h  --g_file mm11.chrom.sizes --Pvalue 10 --c_distal 10 --c_proximal 10   --TSS C2C12_DM60h_promoter.bed  --houseKeeping mouse_houseKeeping_gene_TSS_region.bed    
 ```  
&nbsp; &nbsp; &nbsp; &nbsp; II.The following is an example skipping peak calling. The parameter "-t", "-g", "--Pvalue", which used for peak calling, are replaced by "--Broad_peak".  
 ``` 
Idnetify_SAE.py --macs2_call_peak off --Broad_peak C2C12_DM60h_ATAC_peaks.broadPeak_pfilter.bed.sort.bed -n C2C12_DM60h_ATAC -A -p 8 -b C2C12-DM60h-ATAC.nodup.bam --outdir /path/to/C2C12_DM60h  --g_file mm11.chrom.sizes  --c_distal 10 --c_proximal 10   --TSS C2C12_DM60h_promoter.bed  --houseKeeping mouse_houseKeeping_gene_TSS_region.bed   
 ``` 
 &nbsp; &nbsp; &nbsp; &nbsp; III. The following is an example skipping peak calling and footprint analysis. The parameters "-t", "-g", "--Pvalue", which used for peak calling, are replaced by "--Broad_peak". The parameters "-b", "-A" ,"-p" which used for footprint analysis, are replaced by "--footprint_file". 
 ```
 Idnetify_SAE.py --macs2_call_peak off --wellington_footprints off --Broad_peak C2C12_DM60h_ATAC_peaks.broadPeak_pfilter.bed.sort.bed --Footprint_file C2C12_DM60h_ATAC.WellingtonFootprints.score.bed -n C2C12_DM60h_ATAC --outdir /path/to/C2C12_DM60h  --g_file mm11.chrom.sizes  --c_distal 10 --c_proximal 10   --TSS C2C12_DM60h_promoter.bed  --houseKeeping mouse_houseKeeping_gene_TSS_region.bed
 ```
### 2>link_ATAC_peak_with_gene.py  
The script was used to assign super and typical accessibility elements to each expressed gene and compare the gene expression between the two group genes.    
```
link_ATAC_peak_with_gene.py [options] -s SAE_bed_file -t TAE_bed_file -g  Gene_tss_bed_file  -G Gff_annotation_file  -e Gene_expression_file -o  Output_directory
```
* Explanation of parameters  
-s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  Bed file of SAE.  
-t&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  Bed file of TAE.  
-g&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &ensp; Bed file of gene TSS site.  
-G&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &ensp; Gff annotation file of gene.  
-e&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  Gene expression file.  
-k&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  House keeping gene ID (Optional parameter). If provide this file, these housekeeping genes will be removed in the gene list associated with SAE and TAE.  
-o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  Path to output directory. 
-m&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  The way to link gene with ATAC peak according to the type of SAE and TAE. Could choose "distal" or "proximal".
-h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  Print this help menu.  
* Usage examples  
```
 link_ATAC_peak_with_gene.py -s C2C12_DM60h_ATAC_super_ATAC_broad_peak.bed -t C2C12_DM60h_ATAC_typical_ATAC_broad_peak.bed -g C2C12_expressed_gene_ID_TSS_site_position -G gencode.vM11.chr_patch_hapl_scaff.annotation.gff3 -e C2C12_DM60h_RNAseq_cpm_deseq2_average.txt -k houseKeeping_gene_ID  -o /Path/to/link_gene  -m distal
```
### 3>DifferentialSAE.py  
The script was used to identify differential SAEs between different tissues/cell stages and types considering the change both in ATAC signal and TF footprint binding.     
```
DifferentialSAE.py  --pt  Treatment_ATAC_broad_peak_bed_file --pc   Control_ATAC_broad_bed_file --bt  Treatment_bam_file  --bc  Control_bam_file  --st  Treatment_SAE_bed_file  --sc  Control_SAE_bed_file --nt Treatment_sample_name --nc Control_sample_name --ft Treatment_footprint_peak_bed_file  --fc Control_footprint_bed_file --fs Footprint_Score_threshold -g Genome -d Diff_analysis_method -o output_path  
```
* Explanation of parameters  
--pt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   ATAC broad peak bed file of treatment group.    
--pc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   ATAC broad peak bed file of control group.    
--bt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   ATAC bam file of treatment group.    
--bc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   ATAC bam file of control group.    
--st&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   SAE bed file of treatment group.  
--sc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   TAE bed file of control group.   
--nt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   Experiment name of treatment group.      
--nc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   Experiment name of control group.    
--ft&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   Footprint bed file of treatment group.    
--fc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   Footprint bed file of control group.  
--fs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   Score threshold of footprint of treatment and control group. The footprint with score > set threshold would be used to caclulate footprint number in ATAC broad peak. Recommending minimum footprint score threshold for use in SAE identification of treatment and control group.
-g&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;     Available Genomes:[mm10,hg38,oviAri4,susScr11,bosTau9,galGal5],If no genome is available, specify 'none'.
-d&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;    Differential Expression program selection:[DESeq2,DESeq,edgeR,limma], Default:edgeR.
-o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   Path to output directory.  
-h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   Print this help menu.  
